\documentclass[a4paper,11pt]{jsarticle}

% 数式
\usepackage{amsmath,amsfonts}
\usepackage{amsthm}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{amssymb}

% 表
\usepackage[utf8]{inputenc}
\usepackage{diagbox} % 斜線付きセルを作成するために必要
\usepackage{booktabs} % 表の罫線を美しくするために必要
\usepackage{hhline} % 水平罫線を制御するために必要

% 画像
\usepackage[dvipdfmx]{graphicx}
\usepackage{ascmac}
\usepackage{physics}
\usepackage{float} % 追加

% 図
\usepackage[dvipdfmx]{graphicx}
\usepackage{tikz} %図を描く
\usetikzlibrary{positioning, intersections, calc, arrows.meta, math, matrix} %tikzのlibrary

% ハイパーリンク
\usepackage[dvipdfm,
  colorlinks=false,
  bookmarks=true,
  bookmarksnumbered=false,
  pdfborder={0 0 0},
  bookmarkstype=toc]{hyperref}

% 式番号を章ごとにリセット
\numberwithin{equation}{section}

\begin{document}

\title{メモ}
\author{大上由人}
\date{\today}
\maketitle

\tableofcontents
\newpage

\part{数学}
\section{線形代数}

\begin{itembox}[l]{\textbf{Thm:}}
  実$n$次元数ベクトル空間$\mathbb{R}^n$の任意の部分ベクトル空間$W_1, W_2$に対して、
  \begin{align}
    W_1 \subset W_2 \Rightarrow \dim W_1 \leq \dim W_2
  \end{align}
  が成立する。また、
  \begin{align}
    W_1 \subset W_2 \quad \text{and} \quad \dim W_1 = \dim W_2 \quad \Rightarrow \quad W_1 = W_2
  \end{align}
  が成立する。
\end{itembox}
\textbf{Prf}\\
%後で書く。\\

\section{微分積分学}

\section{確率統計}
\begin{itembox}[l]{\textbf{Thm:Markovの不等式}}
  確率変数$\hat{X}$に対して、任意の正数$\epsilon > 0$に対して、
  \begin{align}
    P(|\hat{X} | \geq \epsilon) \leq \frac{\expval{|X|}}{\epsilon}
  \end{align}
  が成立する。

\end{itembox}
\textbf{Prf}\\
新たに確率変数$\theta$を導入し、
\begin{align}
  \theta = \begin{cases}
    1 & (|\hat{X}| \geq \epsilon)\\
    0 & (|\hat{X}| < \epsilon)
  \end{cases}
\end{align}
とする。このとき、明らかに、
\begin{align}
  \theta \leq \frac{|\hat{X}|}{\epsilon}
\end{align}
が成り立つ。\footnote{グラフを書いてみると良い。}したがって、この関係式に$p$をかけて和をとることで、
\begin{align}
  \ev{\theta} \leq \frac{\expval{|\hat{X}|}}{\epsilon}
\end{align}
が成り立つ。ここで、左辺は、
\begin{align}
  \ev{\theta} = P(|\hat{X} | \geq \epsilon)
\end{align}
であるから、示された。\hfill\qedsymbol\\


\begin{itembox}[l]{\textbf{Thm:チェビシェフの不等式}}
  確率変数$\hat{X}$に対して、任意の正数$\epsilon > 0$に対して、
  \begin{align}
    P(|\hat{X} - \expval{\hat{X}}| \geq \epsilon) \leq \frac{\sigma^2(\hat{X})}{\epsilon^2}
  \end{align}
  が成立する。ただし、$\sigma^2(\hat{X})$は$\hat{X}$の分散である。

\end{itembox}
この結果は、確率分布によらず成り立つことに注意したい。すなわち、期待値と分散さえわかっていれば、確率変数の取りうる範囲が大体どの程度かがわかるということである。\\
また、ゆらぎが測定精度よりもはるかに小さいと仮定すると、
\begin{align}
  P(|\hat{X} - \expval{\hat{X}}| \geq \epsilon) \ll 1
\end{align}
となる。これは、ゆらぎが小さいときは、確率変数を一回だけ測定した値が、期待値と一致することを表している。例えば、統計力学において、熱力学極限をとった時はこのような状況になる。\\

\textbf{Prf}\\
新たに確率変数$\theta$を導入し、
\begin{align}
  \theta_i = \begin{cases}
    1 & (|\hat{X}_i - \expval{\hat{X}}| \geq \epsilon)\\
    0 & (|\hat{X}_i - \expval{\hat{X}}| < \epsilon)
  \end{cases}
\end{align}
とする。このとき、明らかに、
\begin{align}
  \theta_i \leq \frac{(\hat{X}_i - \expval{\hat{X}})^2}{\epsilon^2}
\end{align}
が成り立つ。\footnote{グラフを書いてみると良い。}したがって、この関係式に$p_i$をかけて和をとることで、
\begin{align}
  \ev{\theta} \leq \frac{\sigma^2(\hat{X})}{\epsilon^2}
\end{align}
が成り立つ。ここで、左辺は、
\begin{align}
  \ev{\theta} = P(|\hat{X} - \expval{\hat{X}}| \geq \epsilon)
\end{align}
であるから、示された。\hfill\qedsymbol\\

\begin{itembox}[l]{\textbf{Thm:大数の法則}}
  任意の正の実数$\epsilon$に対して、
  \begin{align}
    \lim_{n \to \infty} P\left(\left|\frac{1}{n} \sum_{i=1}^{n} \hat{X}_i - \expval{\hat{X}}\right| \geq \epsilon\right) = 0
  \end{align}
  が成立する。

\end{itembox}
この定理は、数多くの系で同時に実験をしたときの結果の算術平均が、ほぼ確実に期待値に一致することを示している。\\

\textbf{Prf}\\
ある単独の系において、$\hat{X},\hat{X}^2$の期待値をそれぞれ$\mu=\ev{\hat{X}}_{\vb{p}},\nu=\ev{\hat{X^2}}_{\vb{p}}$とする。このとき、
\begin{align}
  \sigma^2_{\vb{p}}(\hat{X}) = \nu - \mu^2
\end{align}
である。$N$この系での$\hat{X}$の算術平均
\begin{align}
  \hat{m} = \frac{1}{N} \sum_{i=1}^{N} \hat{X}_i
\end{align}
を考える。このとき、線形性から、
\begin{align}
  \expval{\hat{m}} = \frac{1}{N} \sum_{i=1}^{N} \expval{\hat{X}_i}_{\tilde{\vb{p}}} 
\end{align}
となる。また、独立性から、$\ev{\hat{X}_i}_{\tilde{\vb{p}}} = \ev{\hat{X}}_{\vb{p}}=\mu$である。したがって、
\begin{align}
  \expval{\hat{m}} = \mu
\end{align}
である。また、$\hat{m^2}$の期待値は、
\begin{align}
  \expval{\hat{m^2}}_{\tilde{\vb{p}}} = \frac{1}{N^2} \sum_{j,k} \expval{\hat{X}_j \hat{X}_k}_{\tilde{\vb{p}}}\\
  = \frac{1}{N^2} (N\nu + (N^2-N)\mu^2)
\end{align}
となる。したがって、
\begin{align}
  \sigma_{\tilde{\vb{p}}}(\hat{m}) = \sqrt{\expval{\frac{\nu - \mu^2}{N}}}
\end{align}
となる。したがって、
\begin{align}
  \ev{\hat{m}}_{\tilde{\vb{p}}} = \mu, \quad \sigma_{\tilde{\vb{p}}}(\hat{m}) = \frac{\sigma_{\vb{p}}(\hat{X})}{\sqrt{N}}
\end{align}
となる。チェビシェフの不等式より、
\begin{align}
  P(|\hat{m} - \mu| \geq \epsilon) \leq \left(\frac{\sigma_{\vb{p}}(\hat{X})}{\epsilon}\right)^2 \frac{1}{N}
\end{align}
となる。したがって、極限をとって、
\begin{align}
  \lim_{N \to \infty} P(|\hat{m} - \mu| \geq \epsilon) = 0
\end{align}
が示された。\hfill\qedsymbol\\

\textbf{モーメント母関数/キュムラント母関数}\\
\begin{itembox}[l]{\textbf{Def:モーメント母関数/キュムラント母関数}}
  確率分布$p(x)$のモーメント母関数は、以下で定義される。
  \begin{align}
    M(t) = \expval{e^{kx}} = \int e^{kx} p(x) dx \label{eq:moment}\\
    &= \sum_{n=0}^{\infty} \frac{M_n}{n!} t^n
  \end{align}
  このとき、$M_n$をモーメントという。\\
  また、キュムラント母関数は、以下で定義される。
  \begin{align}
    K(t) &= \log M(t) = \log \expval{e^{kx}} \label{eq:cumulant}\\
    &= \sum_{n=0}^{\infty} \frac{C_n}{n!} t^n
  \end{align}
  このとき、$C_n$をキュムラントという。
\end{itembox}
このとき、確率分布と母関数は、一対一に対応することが示される。\\

\begin{itembox}[l]{\textbf{Thm:モーメントとキュムラントの関係}}
  モーメントとキュムラントは以下のように関係する。
  \begin{align}
    &C_1 = M_1\\
    &C_2 = M_2 - M_1^2\label{eq:cumulant2}\\
    &C_3 = M_3 - 3M_1M_2 + 2M_1^3
  \end{align}
\end{itembox}
\textbf{Prf}\\
キュムラント母関数を展開すると、
\begin{align}
  \ln \left\langle e^{s\hat{X}} \right\rangle &= \ln \left\langle 1 + \frac{1}{1!}s\hat{X} + \frac{1}{2!}s^2\hat{X}^2 + \frac{1}{3!}s^3\hat{X}^3 + O(s^4) \right\rangle \nonumber \\
  &= \frac{1}{1!} \left\langle \hat{X} \right\rangle s + \left( \frac{1}{2!} \left\langle \hat{X}^2 \right\rangle - \frac{1}{2} \left\langle \hat{X} \right\rangle^2 \right) s^2 \\
  &+ \left( \frac{1}{3!} \left\langle \hat{X}^3 \right\rangle - \frac{1}{2} \cdot 2 \left\langle \hat{X} \right\rangle \cdot \frac{1}{2!} \left\langle \hat{X}^2 \right\rangle + \frac{1}{3!} \left\langle \hat{X} \right\rangle^3 \right) s^3 + O(s^4) \nonumber \\
  &= \frac{\left\langle \hat{X} \right\rangle}{1!} s + \left( \frac{\left\langle \hat{X}^2 \right\rangle - \left\langle \hat{X} \right\rangle^2}{2!} \right) s^2 + \left( \frac{\left\langle \hat{X}^3 \right\rangle - 3 \left\langle \hat{X} \right\rangle \left\langle \hat{X}^2 \right\rangle + 2 \left\langle \hat{X} \right\rangle^3}{3!} \right) s^3 + O(s^4)
\end{align}
となることから、示された。\hfill\qedsymbol\\

上の関係からわかるように、キュムラント母関数を二階微分することで分散が出てくる。

\begin{itembox}[l]{\textbf{Def:大偏差原理}}
  確率分布$P_N(x)$について、レート関数と呼ばれる関数$I(x)$が存在して、
  \begin{align}
    \lim_{N \to \infty} -\frac{1}{N} \log P_N(x) = I(x)
  \end{align}
  を任意の$x$に対して満たすとき、大偏差原理が成り立つという。
\end{itembox}

\begin{itembox}[l]{\textbf{Thm:ガートナー・エリスの定理}}
  確率変数密度$x$に対するスケールされたキュムラント母関数$q(k)$が存在し、それが実数$k \in \mathbb{R}$で微分可能であるとする。
  このとき、$x$は大偏差原理を満たし、そのレート関数は以下のルジャンドル変換で与えられる。
  \begin{align}
    I(x) = \sup_{k} \{kx - q(k)\}
  \end{align}
  また、逆ルジャンドル変換により、
  \begin{align}
    q(k) = \sup_{b} \{kb - I(b)\}
  \end{align}
  が成り立つ。
\end{itembox}
\textbf{Prf}\\

\section{幾何学}

\section{ラプラス変換}
\begin{itembox}[l]{\textbf{Def:ラプラス変換}}
  関数$f(t)$のラプラス変換は、以下で定義される。
  \begin{align}
    F(s) = \mathcal{L}[f(t)] = \int_{0}^{\infty}  f(t) e^{-st} dt
  \end{align}

\end{itembox}

ラプラス変換には逆変換が存在する。\\
\begin{itembox}[l]{\textbf{Thm:ラプラス逆変換}}
  関数$F(s)$の逆ラプラス変換は、以下で定義される。
  \begin{align}
    f(t) = \mathcal{L}^{-1}[F(s)] = \frac{1}{2\pi i} \int_{\gamma - i \infty}^{\gamma + i \infty}  F(s) e^{st} ds
  \end{align}
  ただし、$\gamma$は右半平面における収束領域を表す。

\end{itembox}
\begin{figure}[H]
  \centering
  \begin{tikzpicture}
    % 半円の半径
    \def\R{3}

    % x軸とy軸
    \draw[->] (-\R-1,0) -- (\R,0) node[right] {};
    \draw[->] (0,-\R-0.5) -- (0,\R+0.5) node[above] {};

    % 左半円
    \draw (\R,0) arc[start angle=0,end angle=90,radius=\R];
    \draw (\R,0) arc[start angle=0,end angle=-90,radius=\R];

    % 線分
    \draw[-] (0,\R) -- (0,-\R);

    % ラベル
    \node at (0.3,-0.3) {$0$};
    \node at (-0.3,\R/2) {$s$};
    \node at (+\R/2,\R/2) {$p$};

    %点pに印
    \fill (\R/2-0.5,\R/2) circle[radius=0.05];

    % 矢印
    \draw[<-] (0,-\R) -- (0,-\R/2);
\end{tikzpicture}
  \caption{逆ラプラス変換の複素積分の積分経路 $C$.}
  \end{figure}
\textbf{Prf}\\
コーシーの積分公式より、正則な領域の点$p$について、
\begin{align}
  F(p) = \frac{1}{2\pi i} \oint_C \frac{F(s)}{s-p} ds
\end{align}
が成り立つ。いま、この線積分で生き残るのは、$Re(s) = \gamma$上の経路のみである。ここで、
\begin{align}
  \frac{1}{s-p} = \int_{0}^{\infty} e^{-(p-s)t}  \quad \because \Re(p) > \Re(s)
\end{align}
であるから、
\begin{align}
  F(p) &= \frac{1}{2\pi i} \int_{\gamma - i \infty}^{\gamma + i \infty} F(s) \int_{0}^{\infty} e^{-(s-p)t} dt ds\\
  &= \int_{0}^{\infty} \left( \frac{1}{2\pi i} \int_{\gamma - i \infty}^{\gamma + i \infty} F(s) e^{st} ds \right) e^{-pt} dt\\
  &= \int_{0}^{\infty} f(t) e^{-pt} dt
\end{align}
が成り立つ。したがって、
\begin{align}
  f(t) = \frac{1}{2\pi i} \int_{\gamma - i \infty}^{\gamma + i \infty}  F(s) e^{st} ds
\end{align}
が示された。\hfill\qedsymbol\\



\section{その他}
\subsection{計算の類}
\textbf{ガウス積分}\\
ガウス積分の変わったやり方を書く。\\
\begin{align}
  \int_{-\infty}^{\infty} x^2 e^{-ax^2} dx
  &=-\int_{-\infty}^{\infty} \dv{a} e^{-ax^2} dx\\
  &=-\dv{a} \int_{-\infty}^{\infty} e^{-ax^2} dx\\
  &=-\dv{a} \sqrt{\frac{\pi}{a}}\\
  &=\frac{\sqrt{\pi}}{2a^{3/2}}
\end{align}
により計算できる。\\

\part{物理}
\section{古典力学}

\section{電磁気学}

\section{熱力学}
熱力学を再構成する。Lieb流にエントロピーを導入して、残りは清水っぽくまとめたい。\\

\begin{itembox}[l]{\textbf{Def:平衡状態/状態空間}}
  平衡状態とは、状態空間の点である。状態空間とは、マクロ変数の値を座標軸とする$\mathbb{R}^n$の部分空間であり、$\Gamma$で表す。
\end{itembox}

\begin{itembox}[l]{\textbf{Axiom1}}
  系を長時間放置すると、系は平衡状態に達し、状態空間上の点で表される。
\end{itembox}

以下、平衡状態のことを単に状態と書くことにする。\\

\begin{itembox}[l]{\textbf{Def:断熱到達可能性}}
  状態$X \in \Gamma$から状態$Y \in \Gamma$へ、断熱到達可能な時、
  \begin{align}
    X \prec Y
  \end{align}
  と書く。ただし、状態$X \in \Gamma$から状態$Y \in \Gamma$へ、断熱到達可能であるとは、外部装置$D$の状態が遷移前後で変化せず、その装置を動かす力学装置のみが変化すること、すなわち、
  \begin{align}
    (X , D , h) \rightarrow (Y , D , h')
  \end{align}
  が成り立つことである。

\end{itembox}

この定義のもと、遷移の公理を以下に示す。\\

\begin{itembox}[l]{\textbf{Axiom2}}
  断熱到達可能性に、以下の性質を要請する。\\
    (A1: 反射律) $ X \overset{A}{\sim} X$\\
    (A2: 推移律) $X \prec Y$かつ$Y \prec Z$ならば、$X \prec Z$\\
    (A3: 一貫性) $X \prec X'$かつ$Y \prec Y'$ならば、$(X,Y) \prec (X',Y')$\\
    (A4: スケーリング不変性) $X \prec Y$ならば、$tX \prec tY$\\
    (A5: 分割と結合) $0<t<1$に対して、$X \overset{A}{\sim} (tX,(1-t)X)$\\
    (A6: 安定性) 0に近づく$\epsilon$の列およびいくつかの状態$Z_0,Z_1$に対して、$(X,\epsilon Z_0) \prec (Y,\epsilon Z_1)$ならば、$X \prec Y$ \\
    (A7: 凸性) 状態空間が凸であるとき、$(tX,(1-t)Y) \prec tX+(1-t)Y$
\end{itembox}
いくらかの補足をする。\\
(A3)について、一般には逆向きの矢印は成り立たない。というのも、系を熱的に接触させることで、片方の系の温度を下げることが可能であるが、そのような接触なしでは温度を下げることはできないからである。
すなわち、複合系は、互いに相互作用させることができるという点で、取りうる操作の種類が多い。\\

(A6)について、この公理は、系に、小さな外部系がくっついているときは、その外部系を無視して、着目系のみを考えてよいということを示している。\\

(A7)について、この公理は、遷移前後で、エネルギーや体積の和が変化しないことを表している。

\begin{itembox}[l]{\textbf{Thm:キャンセル法則}}
  $X,Y,Z$が系の状態のとき、
  \begin{equation}
      (X,Z) \prec (Y,Z) \Rightarrow X \prec Y
  \end{equation}
  が成立する。

\end{itembox}
\textbf{Prf}\\
$\epsilon =\frac{1}{n}$とする。このとき、
\begin{align}
    (X,\epsilon Z) &\overset{A}{\sim} ((1-\epsilon)X,\epsilon X,Z)\\
    &\prec ((1-\epsilon)X,\epsilon Y,Z)\\
    &\overset{A}{\sim} ((1-2\epsilon)X,\epsilon X,\epsilon Y,Z)\\
    &\prec ((1-2\epsilon)Y,2\epsilon Y,Z)
    \end{align}
これを$n=\frac{1}{\epsilon}$回繰り返すと、$X$の係数は0に、$Y$の係数は1に収束する。\\
以上より、$X \prec Y$が示された。\hfill\qedsymbol\\

\begin{itembox}[l]{\textbf{Def:エントロピー}}
  状態空間$\Gamma$上のある$X_0,X_1$に対して、$X_0 \prec \prec X_1$であるとする。このとき、
  \begin{equation}
      S_{\Gamma}(X) = s^* \sup\{\lambda|((1-\lambda)X_0,\lambda X_1) \prec X\}
  \end{equation}
  で定義される関数$S_{\Gamma}$を、基準点$X_0 \prec \prec X_1$に関するエントロピーという。ただし、$s^*$は単位エントロピーである。
\end{itembox}
このエントロピーの意味するところは、
\begin{enumerate}
  \item まず、二つの基準系を$\lambda : 1-\lambda$の比で用意して、複合系とする。
  \item 複合系全体に対して、断熱操作(それぞれの系に独立に作用させても、熱的接触のように二つの系を相互作用させても良い)を行う。
  \item このとき、複合系が状態$X$に達するときの$\lambda$の最大値がエントロピーである。
\end{enumerate}
となる。\\

\begin{itembox}[l]{\textbf{Thm:エントロピー原理}}
  以下の(1),(2)は同値である。\\
  (1) 関係$\prec$が、$\Gamma$の多重スケーリングコピーにおいて、順序の公理A1-A6及び比較仮説(CH)を満たす。\\
  (2) ある関数$S_{\Gamma}:\Gamma \rightarrow \mathbb{R}$が存在して、以下の性質を満たす。\\
  もし、$(t_1+ \cdots +t_n)=t_1'+ \cdots +t_m'$であるとき、
  \begin{equation}
      (t_1 Y_1, \cdots ,t_n Y_n) \prec (t_1' Y_1', \cdots ,t_m' Y_m') \Leftrightarrow S_{\Gamma}(Y_1)+ \cdots +S_{\Gamma}(Y_n) \leq S_{\Gamma}(Y_1')+ \cdots +S_{\Gamma}(Y_m')
  \end{equation}
\end{itembox}
\textbf{Prf}\\
証明は気が向いたら書く。\\

\subsection{その他}

\subsubsection{様々な操作}
自分のメモ用に、操作についてまとめておく。\\
\textbf{熱的接触}\\
田崎熱問題5.1を解いたので、メモとして残しておく。\\
二つの系$(T,X),(T',Y) $を、示量変数を固定したまま接触させて、温度$\tilde{T}$に達するとき、全系について、
\begin{align}
  U(T,X)+U(T',Y) = U(\tilde{T},X)+U(\tilde{T},Y)
\end{align}
が成立し、温度は一意に定まる。\\
また、このとき$T<\tilde{T}<T'$を仮定すると、熱の移動は、
\begin{align}
  Q = U(\tilde{T},X)-U(T,X) = -(U(\tilde{T},Y)-U(T',Y)) 
\end{align}
となる。\\

\subsubsection{熱機関の効率の上限}
\begin{itembox}[l]{\textbf{Thm:カルノーの定理}}
  任意の熱機関の効率の上限は、
  \begin{equation}
    \eta \leq 1-\frac{T_L}{T_H}
  \end{equation}
  と書くことができる。ただし、$\eta$は熱効率、$T_L,T_H$はそれぞれ低温熱浴の温度、高温熱浴の温度である。

\end{itembox}
\textbf{Prf}\\
着目系、高温熱浴、低温熱浴の複合系を考える。このとき、複合経緯の断熱遷移を、
\begin{align}
  ((T,X),(T_H,X_H),(T_L,X_L)) \rightarrow ((T,X),(T_H',X_H),(T_L',X_L))
\end{align}
とする。このとき、エントロピー原理より、
\begin{align}
  S((T,X),(T_H,X_H),(T_L,X_L)) \leq S((T,X),(T_H',X_H),(T_L',X_L))
\end{align}
が成り立つ。ここで、エントロピーの相加性から、
\begin{align}
  S(T,X)+S(T_H,X_H)+S(T_L,X_L) \leq S(T,X)+S(T_H',X_H)+S(T_L',X_L)
\end{align}
が成り立つ。すなわち、
\begin{align}
  S(T_H,X_H) - S(T_H',X_H) \leq S(T_L',X_L) - S(T_L,X_L)
\end{align}
が成り立つ。ここで、左辺について、
\begin{align}
  S(T_H,X_H) - S(T_H',X_H) &= \int_{T_H'}^{T_H} \pdv{S}{T} \dd T\\
  &= \int_{T_H'}^{T_H} \frac{1}{T} \pdv{U}{T} \dd T\\
  &\geq \frac{1}{T_H} \int_{T_H'}^{T_H} \pdv{U}{T} \dd T\\
  &= \frac{1}{T_H} (U(T_H)-U(T_H'))\\
  &= \frac{Q_H}{T_H}
\end{align}
となる。ただし、$Q_H$は高温熱浴からの熱量である。同様の手順により、
\begin{align}
  S(T_L,X_L) - S(T_L',X_L) \leq \frac{Q_L}{T_L}
\end{align}
となる。したがって、
\begin{align}
  \frac{Q_H}{T_H} \leq \frac{Q_L}{T_L}
\end{align}
が成り立つ。すなわち、
\begin{align}
  \frac{T_L}{T_H} \leq \frac{Q_L}{Q_H}
\end{align}
となる。熱効率の定義は、
\begin{align}
  \eta = 1 - \frac{Q_L}{Q_H}
\end{align}
であるから、
\begin{align}
  \eta \leq 1 - \frac{T_L}{T_H}
\end{align}
が成り立つ。\hfill\qedsymbol\\

\section{統計力学}
主に田崎統計を参考にしながら、統計物理の一般的な議論をまとめる。\\
典型性からスタートして、それの表現としての確率分布を導入し、その性質や分布間の関係を考える。\\

熱力学において、我々は、エントロピーなど完全な熱力学関数さえわかれば、諸々の熱力学量を導くことができることを学んだ。統計力学においては、
その完全な熱力学関数の基本関係式を、微視的に導くことが目標である。\\

\subsection{状態数}
\subsubsection{状態数}
\begin{itembox}[l]{\textbf{Def:状態数}}
  エネルギーが$E_i$以下であるような固有状態の数を状態数といい、$\Omega(E_i)$で表す。
\end{itembox}
状態数を一般に計算することはできないが、例えば相互作用のない$N$粒子理想気体など、簡単な系については計算が可能である。\\

\textbf{ex:N粒子理想気体}\\
後に、温度計としての役割を理想気体に担ってもらうため、実際に理想気体の状態数を計算してみる。\\
3次元の箱の中での理想気体のシュレディンガー方程式は、
\begin{equation}
  -\frac{\hbar^2}{2m}\nabla^2 \psi = E \psi
\end{equation}
である。このとき、シュレディンガー方程式を解くと、
\begin{equation}
  E = \frac{\hbar^2 \pi^2}{2mL^2}(n_x^2+n_y^2+n_z^2)
\end{equation}
となることがわかる。ただし、$n_x,n_y,n_z$は自然数である。\\
いま、$E_0 = \frac{\hbar^2 \pi^2}{2mL^2}$とおくと、
\begin{equation}
  E_{n_{\alpha}^{(j)}} = E_0 \sum_{\alpha = x,y,z} \sum_{j=1}^{N} (n_{\alpha}^{(j)})^2
\end{equation}
と表すことができる。このとき、状態数は、
\begin{align}
  \Omega(E) &= \frac{1}{N!} (E_{(n_{\alpha}^{(j)})} \leq E \text{を満たす自然数の組}(n_{\alpha}^{(j)})\text{の数})\\
  &= \frac{1}{N!} (\sum_{\alpha = x,y,z} \sum_{j=1}^{N} (n_{\alpha}^{(j)})^2 \leq \frac{E}{E_0} \text{を満たす自然数の組}(n_{\alpha}^{(j)})\text{の数})
\end{align}
と書くことができる。ただし、ここでは粒子を区別しない方法により状態数を定義している。\\
上の状態数を評価することを考える。このとき、状態数で数える自然数の条件を書き換えると、
\begin{align}
  \sqrt{\sum_{\alpha = x,y,z} \sum_{j=1}^{N} (n_{\alpha}^{(j)})^2} \leq \sqrt{\frac{E}{E_0}}
\end{align}
と書き換えることができる。これは、3N次元空間での球の内部の格子点を数えることに相当する。このとき、球の体積は、
\begin{align}
  V_{3N} = \frac{\pi^{3N/2}}{(3N/2)!}(\frac{E}{E_0})^{3N/2}
\end{align}
なるので、状態数は、
\begin{align}
  \Omega(E) &\sim \frac{1}{N!} \frac{1}{2^{3N}} \frac{\pi^{3N/2}}{(3N/2)!}(\frac{E}{E_0})^{3N/2}\\
  &= \frac{1}{N!} \frac{1}{(3N/2)!}\tilde{\alpha}^N E^{3N/2}V^{N} \label{eq:idealgas}
\end{align}
となる。ただし、第一式での$2^{3N}$は、$3N$次元でのある一つの象限に注目しているために出てきた因子である。また、$\tilde{\alpha}= \qty{\frac{m}{2\pi}}^{3/2}\hbar^{-3}$である。\\
ここで、スターリングの公式を用いて、
\begin{align}
  \Omega(E) &\sim \qty{\frac{e}{N}}^{N} \qty{\frac{e}{3N/2}}^{3N/2} \tilde{\alpha}^N E^{3N/2}V^{N}\\
  &= \alpha^N \qty{\frac{E}{V}}^{3N/2}\qty{\frac{V}{N}}^{5N/2}
\end{align}
と書くことができる。ただし、$\alpha = \qty{e^{5/2}(2/3)^{3/2}\tilde{\alpha}}$である。\\
対数をとると、
\begin{align}
  \log \Omega(E) &\simeq N \log ( \alpha \qty{\frac{E}{V}}^{3/2}\qty{\frac{V}{N}}^{5/2} )\\
  &= V(\rho \log (\alpha \epsilon^{3/2}\rho^{-5/2}))
\end{align}
のように体積をくくりだすことができる。ただし、
\begin{align}
  \rho = \frac{N}{V}, \epsilon = \frac{E}{N}
\end{align}
である。したがって、
\begin{align}
  \Omega (E) &\sim \exp(V\sigma(\rho, \epsilon))
\end{align}
と書くことができる。\\

ただし、
\begin{align}
  \sigma(\rho, \epsilon) &= \rho \log (\alpha \epsilon^{3/2}\rho^{-5/2}) \label{eq:idealsigma}
\end{align}
である。\\

\subsubsection{状態数の振る舞い}
一般に、相互作用がある場合の状態数の振る舞いについて考える。
ここでは厳密に示すことはしないが、"普通の"熱力学的な系について、以下が成り立つことが知られている。\\
\begin{itembox}[l]{\textbf{Thm:状態数の熱力学極限}}
  $v(|\bm{r}|)$を相互作用のポテンシャルとする。このとき、
  \begin{enumerate}
    \item ある定数$r_0$が存在し、任意の$|\bm{r}|>r_0$に対して、
    \begin{equation}
    v(|\bm{r}|) \leq 0
    \end{equation}
    が成り立つ。
    \item ある定数$b>0$が存在して、任意の粒子数$N$と任意の粒子の位置$\bm{r}_1, \cdots , \bm{r}_N$に対して、
    \begin{equation}
    \sum_{i,j}^{N} v(|\bm{r}_i - \bm{r}_j|) \geq -bN
    \end{equation}
    が成り立つ。
  \end{enumerate}
  このとき、$\frac{N}{V}$を一定に保ちながら体積を大きくしたとき、基底エネルギー密度の極限
  \begin{equation}
    \epsilon_0(\rho) = \lim_{V \rightarrow \infty} \frac{E_0(V,N)}{V}
  \end{equation}
  が存在する。\\
  また、$\epsilon_0(\rho)<\infty$であるとき、任意の$\rho >0, \epsilon > \epsilon_0(\rho)$に対して、$\rho$と$\epsilon$を一定に保って体積を大きくしたときの極限
  \begin{equation}
    \sigma (\rho, \epsilon) = \lim_{V \rightarrow \infty} \frac{\log \Omega_{V,N}(E)}{V}
  \end{equation}
  が存在する。このとき、関数$\sigma(\rho, \epsilon)$は、$\epsilon$の増加関数であり、$\rho,\epsilon$について上に凸である。
\end{itembox}
上の二つの条件を見ていく。一つ目の条件は、遠方で、引力相互作用が働くことを表している。無限遠で相互作用ポテンシャルが$0$に漸近することを考えると、漸近の仕方は2通り(正から近づくか負から近づくか)あるが、ここでは、負から近づくことを考えている。\\
そもそも遠方で斥力が働く系では、系全体が無限に広がってしまうのだから明らかに普通ではない。\\
二つ目の条件は、逆に、系のポテンシャルエネルギーの下限を定めている。あまりにポテンシャルエネルギーの極小値が小さいと、無数の粒子が強い引力で凝縮するというこれまた病的な状態となってしまう。\\

このようなとき、状態数は、
\begin{equation}
  \Omega_{V,N}(E) \sim \exp(V\sigma(\rho, \epsilon))
\end{equation}
と表すことができる。同様の議論は、粒子数を大きくするときにもできて、
\begin{equation}
  \Omega_{V,N}(E) \sim \exp(N\sigma(\rho, \epsilon))
\end{equation}
と表すことができる。

\subsection{典型性}
\begin{itembox}[l]{\textbf{Def:"許された状態"}}
  "許された状態"とは、マクロに見たときの系のエネルギーにほぼ等しいエネルギーをもつ状態およびその重ね合わせの状態のことである。\footnote{エネルギーを用いて定義しているわけだが、ほかの変数を用いて定義することはできないのかなと思う。}
\end{itembox}
このことを用いて、以下の要請を考える。\\

\begin{itembox}[l]{\textbf{Post:典型性}}
  ある系の平衡状態がもつ性質は、"許された状態"のうち、典型的な状態が共通に持つ性質のことである。\\
  また、非平衡状態か平衡状態に緩和するとは、"許された状態"のうち、典型的でないものが、典型的なものに遷移することである。
\end{itembox}
このとき、我々は、典型的な状態のほうが、非典型的な状態よりも圧倒的に多く存在すると考える。\\

典型性の要請から、系の状態を何らかの方法で平均すると、期待値として平衡状態における値が返ってくるはずである。我々が統計力学を組み立てていくうえですべき残りのことは、
状態を、適当な重みづけにより混合することで確率分布を構成し、その確率分布が平衡状態を記述するうえでふさわしいことを確かめることである。後者は特に、示量変数の密度のゆらぎが十分に小さいことを確かめればよい。
以下、特に熱力学の知見との対応をとりやすいような混合の仕方を見ていく。\\

\subsection{ミクロカノニカル分布}
一番シンプルな重みづけの方法として、すべての状態を等確率に混ぜ合わせる手法が考えられる。

\begin{itembox}[l]{\textbf{Def:ミクロカノニカル分布}}
  エネルギー固有値が、
  \begin{equation}
    U - V\delta < E_{i} < U
  \end{equation}
  であるような状態の数を、
  \begin{equation}
    W(U,\delta) = \Omega (U) - \Omega(U-\delta)
  \end{equation}
  とかく。このとき、
  \begin{align}
    p_i = \frac{1}{W(U,\delta)} \quad (U-\delta < E_i < U)\\
    p_i = 0 \quad (\text{otherwise})
  \end{align}
  で定義される分布をミクロカノニカル分布という。
\end{itembox}

注意されたいこととして、我々は、あくまでも物理量の期待値に関心があり、ある状態$i$が選ばれる確率それ自体に物理的な意味はない。例えば、MCを少し加工したものとして、奇数番目の状態を選ぶ確率を$0$とし、
偶数番目を選ぶ確率を$2p_i$としても、物理量の期待値に影響は出ないであろう。したがって、あくまでも確率それ自体には物理的な意味はなく、単に混ぜ合わせているだけである。\\

状態数の振る舞いを考えると、実は、ミクロカノニカル分布を拡張することができる。いま、系が"許された状態"に入っていない確率を計算すると、
\begin{align}
  p &= \frac{\Omega(U-\delta)}{\Omega(U)}\\
  &= \exp(V\sigma(U-\delta V,\epsilon)-V\sigma(U,\epsilon))\\
  &= \exp(-V\pdv{\sigma}{u}\delta )
  \ll 0 
\end{align}
となる。このことから、ミクロカノニカル分布を以下のように拡張する。
\begin{itembox}[l]{\textbf{Def:拡張されたミクロカノニカル分布}}
  エネルギー固有値が$U$以下である状態の数を$\Omega(U)$とする。このとき、
  \begin{align}
    p_i = \frac{1}{\Omega(U)} \quad (E_i \leq U)\\
    p_i = 0 \quad (\text{otherwise})
  \end{align}
  で定義される分布を拡張されたミクロカノニカル分布という。
\end{itembox}
これは、熱力学極限においては、状態数は、相空間の"表皮"の部分に集中することを意味している。\\

この拡張されたミクロカノニカル分布を用いて、以下のようにエントロピーを定義する。\\
\begin{itembox}[l]{\textbf{Def:MCにおけるエントロピー}}
  MCにおけるエントロピー$S$は、
  \begin{equation}
    S(U,V,N) = k_{B} \log \Omega_{V,N}(U) \label{eq:mcentropy}
  \end{equation}
  により定まる。

\end{itembox}
注意されたいこととして、この定義から、MCは、熱力学でいうところの$(U,V,N)$表示に対応することがわかる。\\
ところで、上では定義としたエントロピーだが、適切な仮定により導くことができる。\\

\begin{itembox}[l]{\textbf{Thm:エントロピーの導出}}
  エントロピー$S$が以下の条件を満たすとする:
  \begin{enumerate}
    \item $S$が、熱力学で得られたエントロピーと一致する。
    \item 平衡状態が統計力学により記述される。
    \item ミクロな力学によって現れる$(U,V,N)$は、それぞれマクロに見たエネルギー、体積、粒子数である。
    \item 熱力学的な系への力学的操作は、ミクロな力学では、ハミルトニアンのパラメータ変化として表現できる。
  \end{enumerate}
  このとき、エントロピーは(\ref{eq:mcentropy})式で表される。
\end{itembox}
\textbf{Prf}\\
熱力学のほうから準備をする。平衡状態$(U,V,N)$から体積を$V+\Delta V$まですばやく変化させ、平衡状態$(U+\Delta U,V+\Delta V,N)$に緩和させる。すなわち、
\begin{equation}
  (U,V,N) \underset{a}{\rightarrow} (U+\Delta U,V+\Delta V,N) 
\end{equation}
という操作を考える。この操作が準静的に近いとすると、
\begin{equation}
  S(U,V,N) = S(U+\Delta U,V+\Delta V,N) + O(\Delta V ^2)
\end{equation}
となる。ここで、$S$は、熱力学的なエントロピーである。\\
同じ状況を統計力学的に考察してみる。今、4つめの仮定から、操作者が外からする仕事はハミルトニアンのパラメータ変化によって記述され、
\begin{equation}
  \Delta W = \expval{\hat{H}(V+\Delta V)-\hat{H}(V)}_{U,V}^{\text{MC}}
\end{equation}
となる。ここで、MCを拡張したときの議論を思い出すと、あくまでも、エネルギー固有値が上辺の$U$に近いエネルギー固有状態のみが期待値に寄与するので、
\begin{equation}
  U = \expval{\hat{H}}_{U,V}^{\text{MC}}
\end{equation}
と書くことができる。今、断熱操作でのエネルギー変化が仕事$\Delta W$であることから、
\begin{equation}
  U + \Delta U = \expval{\hat{H}(V)}_{U,V}^{\text{MC}} + \Delta W = \expval{\hat{H}(V+\Delta V)}_{U,V}^{\text{MC}}
\end{equation}
となる。最右辺について、$\Delta V$について展開すると、
\begin{align}
  \expval{\hat{H}(V+\Delta V)}_{U,V}^{\text{MC}} &= \expval{\hat{H}(V) + \pdv{\hat{H}}{V}\Delta V}_{U,V}^{\text{MC}} + O((\Delta V)^2)\\
  &= \frac{1}{\tilde{\Omega(U,V)}_{V,N}(U)}\sum_{i}^{\tilde{\Omega(U,V)}_{V,N}(U)} (E_i(V) + \pdv{E_i}{V}\Delta V) + O((\Delta V)^2)\\
  &= \frac{1}{\tilde{\Omega(U,V)}_{V,N}(U)}\sum_{i}^{\tilde{\Omega(U,V)}_{V,N}(U)} E_i(V+\Delta V) + O((\Delta V)^2)
\end{align}
となる。一方、
\begin{align}
  U + \Delta U &= \expval{\hat{H}(V+\Delta V)}_{U,V+\delta V}^{\text{MC}}\\
  &= \frac{1}{\tilde{\Omega(U,V+\delta V)}_{V,N}(U)}\sum_{i}^{\tilde{\Omega(U,V+\delta V)}_{V,N}(U)} E_i(V+\Delta V) 
\end{align}
である。右辺同士を比較して、
\begin{equation}
  \Omega_{V,N}(U) = \tilde{\Omega(U,V)}_{V+\delta V,N}(U) + O((\Delta V)^2)
\end{equation}
となる。したがって、エントロピーは、状態数の関数で表されると考えられる。\\
また、エントロピーが相加性を持つことから、関数形としては、状態数の対数をとればよいことがわかる
\footnote{これは示すことができる。やりたいことは、
\begin{equation}
  f(pq) = f(p) + f(q)
\end{equation}
を満たすような関数$f$が対数関数であることを示すことである。両辺$p$で微分して、
\begin{equation}
  qf'(pq) = f'(p)
\end{equation}
となる。$p=1$とすると、
\begin{equation}
  f'(q) = \frac{1}{q}f'(1)
\end{equation}
となる。これを両辺積分して、
\begin{equation}
  f(q) = f'(1)\log q + C
\end{equation}
となる。ここで、$f(1)=0$なので、$C=0$である。よって、
\begin{equation}
  f(q) = a \log q
\end{equation}
となる。}。

したがって、$\log \Omega_{V,N}(U)$は、エントロピーの持つべき資格を満たしていることになる。ところで、熱力学の知見より、エントロピーはこれの定数倍と定数の足し算になることがわかる。すなわち、
\begin{equation}
  S(U,V,N) = a \log \Omega_{V,N}(U) + b
\end{equation}
と表されることがわかる。一般性を失うことなく、(または、熱力学第三法則に適合するように)、$b=0$としてよい。\\
ここで、$a$の値を決めることを考える。ここで、上で準備した理想気体を用いる。\\
理想気体については、
\begin{equation}
  \log \Omega_{V,N}(U) \simeq N\log \qty(\alpha \qty(\frac{N}{V})^{-\frac{5}{2}}\qty(\frac{U}{N})^{\frac{3}{2}})
\end{equation}
であることがわかっている。また、
\begin{equation}
  \pdv{S}{U} = a\frac{3}{2}\frac{N}{U}
\end{equation}
となる。ところで、熱力学の知見より、
\begin{equation}
  \pdv{S}{U} = \frac{1}{T}
\end{equation}
である。したがって、
\begin{equation}
  \frac{3}{2}a N \qty(\frac{3}{2}NkT)^{-1} = \frac{1}{T}
\end{equation}
となる。これを解いて、
\begin{equation}
  a = k
\end{equation}
となる。以上より、エントロピーは、
\begin{equation}
  S(U,V,N) = k \log \Omega_{V,N}(U)
\end{equation}
となることがわかる。\hfill\qedsymbol\\

また、エントロピーが示量性を持つことも示すことができる。\\
\begin{itembox}[l]{\textbf{Thm:エントロピーの示量性}}
  (\ref{eq:mcentropy})式で定義されるエントロピーは、熱力学極限において示量性を持つ。
\end{itembox}
\textbf{Prf}\\
状態数の熱力学極限を考えると、普通の系については、
\begin{equation}
  s(u,\rho) = \lim_{V \rightarrow \infty} \frac{k}{V}\log \Omega_{V,N}(U)
\end{equation}
が極限を持つ。この左辺はエントロピー密度を表しており、エントロピー密度の熱力学極限が定義できることから、たしかに熱力学極限において、エントロピーは示量性を持つことがわかる。\hfill\qedsymbol\\

また、このとき定義されたエントロピー密度が、その二つの変数に対して上に凸であることは、状態数の熱力学極限の話から直ちに得られる。\\

\subsection{カノニカル分布}
別の混合の仕方として、エネルギーに対して重みづけをする方法がある。\\
\begin{itembox}[l]{\textbf{Def:カノニカル分布}}
  カノニカル分布は、エネルギー$E_i$に対して、
  \begin{equation}
    p_i = \frac{e^{-\beta E_i}}{Z}
  \end{equation}
  で定義される分布である。ただし、$Z$は規格化定数であり、
  \begin{equation}
    Z = \sum_{i}^{n} e^{-\beta E_i}
  \end{equation}
  である。この規格化定数を分配関数という。

\end{itembox}
カノニカル分布は、究極的には天から降ってくる重みづけの仕方としてもよいのだが\footnote{典型性の話を思い出すとよい。}、ここでは、ミクロカノニカル分布を前提にして、カノニカル分布を導出する。\\
系のエネルギーを$E_i$、熱浴のエネルギーを$B_j$とする。このとき、全系の内部エネルギーが、マクロにみて$U$であるときの"許された状態"は、
\begin{equation}
  U - \delta V_{R} < E_i + B_j < U
\end{equation}
である。これを変形して、
\begin{equation}
  U - E_i - \delta V_{R} < B_j < U - E_i
\end{equation}
となる。これを用いて、系がエネルギー状態$E_i$にある状態数は、
\begin{equation}
  \Omega_{i} = \Omega(U-E_i) - \Omega(U-E_i-\delta V_{R})
\end{equation}
により計算される。このとき、系がエネルギー状態$E_i$にある確率は、
\begin{equation}
  p_i = \frac{\Omega_i}{\Omega_{\text{total}}}
\end{equation}
である。ここで、熱浴の状態数を、
\begin{equation}
  \Omega_{R} (B) = \exp(V_{R}\sigma \left(\frac{B}{V_{R}},\frac{N_{R}}{V_{R}}\right))
\end{equation}
と書くことができる。
$\tilde{U} = U - E_i$とおくと、
\begin{align}
  p_i &= \frac{\Omega(\tilde{U}) - V_{R}\delta}{\Omega(\tilde{U})} \\
  &= \exp(V_{R}\{\sigma(\tilde{u}-\delta ,\rho) - \sigma(\tilde{u},\rho)\} + o(\delta))\\
  &= \exp(-V_{R}\left(\pdv{\tilde{u}}\sigma(\tilde{u},\rho)\delta + o(\delta^2)\right)+ o(V_R\delta))\ll 1
\end{align}
を満たす。ただし、$\tilde{u} = \frac{U}{V_{R}}$であり、熱浴の体積が十分大きいことを用いている。\\
このとき、
\begin{align}
  p_i &\simeq \frac{\Omega_{R}(U-E_i)}{\sum_{j}^{n} \Omega_{R}(U-E_j)}\\
  &= \frac{\Omega_{R}(U-E_i)}{\Omega_{R}(U)}\left(\sum_{j}^{n} \frac{\Omega_{R}(U-E_j)}{\Omega_{R}(U)}\right)^{-1}
\end{align}
と書ける。ここで、
\begin{align}
  \log \frac{\Omega_{R}(U-E_i)}{\Omega_{R}(U)} &= \log \Omega_{R}(U-E_i) - \log \Omega_{R}(U)\\
  &= -E_{i}\pdv{U}\log \Omega_{R}(U) + \frac{E_{i}^2}{2}\pdv{U}^2 \log \Omega_{R}(U) + \cdots\\
  &= -\frac{E_{i}}{V_{R}}\pdv{u}\{V_R\sigma(u,\rho) + o(V_R)\} + \frac{E_{i}^2}{2V_{R}^2}\pdv{u}^2\{V_R\sigma(u,\rho) + o(V_R)\} + \cdots\quad \\
  &= -E_{i}\pdv{u}\sigma(u,\rho) + \frac{1}{V_{R}}\frac{E_{i}^2}{2}\pdv{u}^2\sigma(u,\rho) +\cdots +\frac{o(V_R)}{V_{R}}\\
  &\simeq -\beta(u,\rho)E_{i} \quad \because \text{$V_{R}$が十分大きい}
\end{align}
となる。ここで、$\beta(u,\rho) = \pdv{u}\sigma(u,\rho)=\pdv{U}\log \Omega_{R}(U)$である。これにより、
\begin{align}
  \frac{\Omega_{R}(U-E_i)}{\Omega_{R}(U)} &= \exp(-\beta(u,\rho)E_{i})
\end{align}
と書くことができ、
\begin{align}
  p_i &= \frac{\exp(-\beta(u,\rho)E_{i})}{Z(\beta)}
\end{align}
と書くことができる。ただし、$Z$は規格化定数であり、
\begin{align}
  Z(\beta) &= \sum_{i} \exp(-\beta(u,\rho)E_{i})
\end{align}
である。\\
また、$N$この粒子を区別しないときには、エネルギー固有状態についての和を、$N!$で割ればよい。すなわち、
\begin{align}
  Z'_{V,N}(\beta) = \frac{1}{N!}Z_{V,N}(\beta)
\end{align}
により新たな分配関数を定義すればよい。このとき、期待値の表式は、
\begin{align}
  \expval{f}_\beta^{\text{can}} = \frac{1}{Z'_{V,N}(\beta)}\frac{1}{N!}\sum_{i} f_i \exp(-\beta E_i)
\end{align}
となる。以下、このときの分配関数も$Z$と書くことにする。\\

パラメータ$\beta$の物理的な意味を考える。理想気体における状態数を温度計として使うと、定義から、
\begin{align}
  \beta(u,\rho) &= \pdv{u}\sigma(u,\rho)\\
  &= \pdv{u}(\rho \log (\alpha u^{3/2}\rho^{-5/2}))\\
  &= \frac{3\rho}{2u}\\
  &= \frac{3}{2}\frac{N_R}{U_{total}}
\end{align}
となる。ところで、熱力学の知見より、
\begin{align}
  U_{total} = \frac{3}{2}N_R kT
\end{align}
である。したがって、
\begin{align}
  \beta = \frac{1}{kT}
\end{align}
となる。この$\beta$は逆温度と呼ばれる。\\
 
以下、この分布を用いて、熱力学で登場する物理量を導出する。\footnote{ただし、これは熱力学極限をとらずとも定義できる。ただし、その整合性は熱力学極限をとったときにゆらぎが小さいことから確かめる。}\\

\textbf{ex:N粒子理想気体}\\
後に、温度計としての役割を理想気体に担ってもらうため、理想気体の分配関数を計算してみる。\\
今、ハミルトニアンは、
\begin{equation}
    H = \sum_{j}^{N} \frac{\vb{p}_j^2}{2m}
\end{equation}
である。このとき、分配関数は、
\begin{equation}
    Z = \frac{1}{N!h^{3N}} \int \dd{\vb{p}_1} \cdots \int \dd{\vb{p}_N} \dd{\vb{q}_1} \cdots \dd{\vb{q}_N} \exp(-\frac{\beta}{2m} \sum_{j}^{N} \vb{p}_j^2)
\end{equation}
である。ここで、
\begin{equation}
    \int \dd{\vb{q}_1} \cdots \int \dd{\vb{q}_N} = V^N
\end{equation}
であり、また、ガウス積分を用いて、
\begin{equation}
    \int \dd{\vb{p}_1} \cdots \int \dd{\vb{p}_N} \exp\left(-\frac{\beta}{2m} \sum_{j}^{N} \vb{p}_j^2\right) = \left( \frac{2\pi m}{\beta} \right)^{3N/2}
\end{equation}
であるから、
\begin{equation}
    Z = \frac{V^N}{N!h^{3N}} \left( \frac{2\pi m}{\beta} \right)^{3N/2} \label{eq:idealz}
\end{equation}
となる。


\begin{itembox}[l]{\textbf{Prop:エネルギー期待値と分散/比熱}}
  カノニカル分布において、エネルギーの期待値と分散は、
  \begin{align}
    \expval{E} &= -\pdv{\beta}\ln Z\\
    \sigma^2 &= \pdv[2]{\beta}\ln Z
  \end{align}
  で与えられる。また、比熱は、
  \begin{align}
    C = \frac{1}{kT^2}\sigma^2
  \end{align}
  で与えられる。

\end{itembox}
\textbf{Prf}\\
\begin{align}
  -\pdv{\beta}\log Z &= -\frac{1}{Z}\pdv{Z}{\beta}\\
  &= -\frac{1}{Z}\pdv{}{\beta}\sum_{i}e^{-\beta E_{i}}\\
  &= -\frac{1}{Z}\sum_{i}(-E_{i})e^{-\beta E_{i}}\\
  &= \sum_{i}E_{i}p_{i}\\
  &= \expval{E}
\end{align}

\begin{align}
  \ev{E^2} &= \sum_{i}E_{i}^2p_{i}\\
  &=\sum_{i}E_{i}^2\frac{e^{-\beta E_{i}}}{Z}\\
  &=\frac{1}{Z}\pdv[2]{beta}\sum_{i}e^{-\beta E_{i}}\\
  &=\frac{Z''}{Z}
\end{align}
となる。したがって、

\begin{align}
  \sigma^2 &= \ev{E^2} - \ev{E}^2\\
  &= \frac{Z''}{Z} - \left( \frac{Z'}{Z} \right)^2\\
  &= \frac{Z''Z - Z'^2}{Z^2}\\
  &=\pdv[2]{\beta}\log Z
\end{align}
となる。さらに、
\begin{align}
  C(T)&=\pdv{\ev{E}}{T}\\
  &=\pdv{\beta}{T}\pdv{\ev{E}}{\beta}\\
  &=\frac{1}{kT^2}\pdv[2]{\beta}\log Z\\
  &=\frac{1}{kT^2}(\ev{E^2}-\ev{E}^2)
\end{align}
である。以上より示された。\hfill\qedsymbol\\

\begin{itembox}[l]{\textbf{Def:ヘルムホルツ自由エネルギー}}
  カノニカル分布において、ヘルムホルツ自由エネルギーは、
  \begin{align}
    F = -\frac{1}{\beta}\ln Z_{V,N}(\beta) \label{eq:helmholtz}
  \end{align}
  により定まる。
\end{itembox}

\begin{itembox}[l]{\textbf{Thm:ヘルムホルツ自由エネルギーの導出}}
  ヘルムホルツ自由エネルギーが以下の条件を満たすとする:
  \begin{enumerate}
    \item ヘルムホルツ自由エネルギーが、熱力学で得られたヘルムホルツ自由エネルギーと一致する。
    \item 平衡状態が統計力学により記述される。
    \item ミクロな力学によって現れる$(U,V,N)$は、それぞれマクロに見たエネルギー、体積、粒子数である。
    \item 熱力学的な系への力学的操作は、ミクロな力学では、ハミルトニアンのパラメータ変化として表現できる。
  \end{enumerate}
  このとき、ヘルムホルツ自由エネルギーは、(\ref{eq:helmholtz})式で表される。

\end{itembox}
\textbf{Prf}\\
熱力学のほうから準備する。平衡状態$(T,V,N)$から体積を$V+\Delta V$まですばやく変化させ、平衡状態$(T,V+\Delta V,N)$に緩和させる。すなわち、
\begin{equation}
  (T,V,N) \underset{a}{\rightarrow} (T,V+\Delta V,N)
\end{equation}
という操作を考える。この操作が準静的に近いとすると、
\begin{equation}
  F(T,V,N) - F(T,V+\Delta V,N) = W_{\text{max}} + O(\Delta V^2)
\end{equation}
となる。ここで、$F$は、熱力学的なヘルムホルツ自由エネルギーである。\\
同じ状況を統計力学的に考察してみる。今、4つめの仮定から、操作者が外からする仕事はハミルトニアンのパラメータ変化によって記述され、
\begin{equation}
  \Delta W = \expval{\hat{H}(V+\Delta V)-\hat{H}(V)}_{T,V}^{\text{can}}
\end{equation}
と書くことができる。\\
ここで、準静的等温陛下について、内部エネルギーの変化が無視できると仮定すると\footnote{そんなわけない。ここの証明はダメそう。備忘録として書いておく。}
\begin{equation}
  \ev{H(V+\Delta V)}_{T,V+\Delta V}^{\text{can}} = \ev{H(V)}_{T,V}^{\text{can}}
\end{equation}
となる。したがって、
\begin{equation}
  \Delta W = \ev{H(V+\Delta V)}_{T,V}^{\text{can}} - \ev{H(V+\Delta V)}_{T,V+\Delta V}^{\text{can}}
\end{equation}
となる。期待値を展開して、
\begin{align}
  \Delta W &= \ev{H(V)}_{T,V}^{\text{can}} - \ev{H(V)}_{T,V+\Delta V}^{\text{can}}\\
  &= \left(\frac{1}{Z_{V,N}(\beta)}-\frac{1}{Z_{V+\Delta V,N}(\beta)}\right)\sum_{i}H_i e^{-\beta E_i}
\end{align}
と書くことができる。よって、自由エネルギーは。分配関数の関数となることがわかる。\\
また、エントロピーのときと同様に、ヘルムホルツ自由エネルギーは、
\begin{equation}
  F(T,V,N) = a\log Z_{V,N}(\beta) + b
\end{equation}
と表されることがわかる。$b=0$としてよい。\\
理想気体と比較することで、
\begin{equation}
  a = -\frac{1}{\beta}
\end{equation}
となることがわかる。以上より示された。\hfill\qedsymbol\\


\begin{itembox}[l]{\textbf{Prop:エントロピー}}
  カノニカル分布において、エントロピーは、
  \begin{align}
    S(\beta,V,N) = -k\sum_{i}p_{i}\log p_{i} -k\log N!
  \end{align}
  で与えられる。

\end{itembox}

\begin{itembox}[l]{\textbf{Lem:}}
  カノニカル分布において、エントロピーは、
  \begin{align}
    S(T,V,N) = \frac{\ev{\hat{H}}_{T,V}^{\text{can}} - F(T,V,N)}{T}
  \end{align}
  と書くことができる。

\end{itembox}
\textbf{Prf}\\
熱力学の知見より、
\begin{align}
  S &= -\pdv{F}{T}\\
  &= -\pdv{F}{\beta}\pdv{\beta}{T}\\
  &= \frac{1}{kT^2}\left(\frac{1}{\beta^2}\log Z -\frac{1}{\beta}\frac{Z'}{Z} \right)\\
  &= k\log Z -k\frac{Z'}{Z}\\
  &= \frac{\ev{\hat{H}}_{T,V}^{\text{can}} - F(T,V,N)}{T}
\end{align}
となる。以上より示された。\hfill\qedsymbol\\

\textbf{Prf(Prop)}\\
\begin{align}
  -k\sum_{i}p_{i}\log p_{i} &= -k\sum_{i}\frac{e^{-\beta E_{i}}}{Z}\log(\beta E_i-\log Z)\\
  &= k\beta \sum\left(\frac{E_{i}e^{-\beta E_{i}}}{Z}\right) + k\sum_{i}\left(\frac{e^{-\beta E_{i}}}{Z}\log Z\right)\\
  &= \frac{1}{T}\ev{\hat{H}}_{T,V}^{\text{can}} -\beta k\sum_i\left(\frac{e^{-\beta E_{i}}}{Z}F\right)\\
  &= \frac{\ev{\hat{H}}_{T,V}^{\text{can}} - F(T,V,N)}{T}
\end{align}
となる。これと補題より示された。\hfill\qedsymbol\\

次に、熱力学極限を考える。
\begin{itembox}[l]{\textbf{Thm:ヘルムホルツ自由エネルギー密度}}
  統計力学的に定めたヘルムホルツ自由エネルギーについて、
\begin{align}
  f(\beta,\rho)= \lim_{V\rightarrow \infty} \frac{1}{V}F(\beta,V,N) = -\frac{1}{V\beta}\log Z
\end{align}
の極限が存在する。この極限をヘルムホルツ自由エネルギー密度という。
\end{itembox}
\textbf{Prf}\\
状態数の熱力学極限と同様に従う。\hfill\qedsymbol\\

上の熱力学極限は、ヘルムホルツ自由エネルギーが、
\begin{align}
  F(\beta,V,N) = Vf(\beta,\rho) + o(V)
\end{align}
と表されることを意味している。これを用いて、エネルギー密度の期待値やゆらぎを考える。

\begin{itembox}[l]{\textbf{Prop:エネルギー密度の期待値とゆらぎ}}
  カノニカル分布において、エネルギー密度の期待値とゆらぎは、
  \begin{align}
    \expval{\epsilon} &\simeq \pdv{\beta}(\beta f(\beta,\rho))\\
    \sigma_{\beta}^{\text{can}} (\epsilon) &\simeq \frac{1}{\sqrt{V}}\sqrt{-\pdv[2]{\beta}(\beta f(\beta,\rho))}
  \end{align}
  で与えられる。
\end{itembox}
\textbf{Prf}\\
\begin{align}
  \expval{\epsilon} &= -\frac{1}{V}\pdv{\beta}\log Z\\
  &= \pdv{\beta}(\beta f(\beta,\rho))+\frac{o(V)}{V}
\end{align}
となる。また、
\begin{align}
  \sigma_{\beta}^{\text{can}} (\epsilon) &= \frac{1}{V}\sqrt{\pdv[2]{\beta}\log Z}\\
  &= \frac{1}{\sqrt{V}}\sqrt{-\pdv[2]{\beta}(\beta f(\beta,\rho))} + \frac{o(V)}{V}
\end{align}
となる。以上より示された。\hfill\qedsymbol\\

したがって、たしかに、カノニカル分布による状態の混合は、熱力学極限においてゆらぎが十分小さく、混ぜ合わせ方として妥当であることがわかる。\\

\subsection{グランドカノニカル分布}
他の混合の仕方として、粒子数に対しても重みづけをする方法がある。\\
\begin{itembox}[l]{\textbf{Def:グランドカノニカル分布}}
  グランドカノニカル分布は、エネルギー$E_i$、粒子数$N_i$に対して、
  \begin{equation}
    p_i = \frac{e^{-\beta( E_i - \mu N_i)}}{\Xi}
  \end{equation}
  で定義される分布である。ただし、$Z$は規格化定数であり、
  \begin{equation}
    \Xi = \sum_{i}^{n} e^{-\beta( E_i - \mu N_i)}
  \end{equation}
  である。この規格化定数を大分配関数という。

\end{itembox}
気が向いたら書くが、カノニカル分布から導出可能である。\\

\subsection{モデルの等価性}
これまで導いてきた分布が等価であることを示す。具体的な手続きとしては、まずミクロカノニカル分布が$(U,V,N)$表示に対応することを示し、次に、ミクロカノニカル分布とカノニカル分布がルジャンドル変換によって結ばれることを統計力学側の視点から示す。グランドカノニカル分布についても同様である。\\

\subsubsection{ミクロカノニカル分布とカノニカル分布}
体積$V$、粒子数$N$を固定した系を考える。分配関数の和をとる時に、$\Delta > 0$を$\beta \Delta \ll 1$となるような数として、粗視化する。すなわち、
\begin{align}
  Z_{V,N}(\beta) &= \frac{1}{N!}\sum_{i}e^{-\beta E_{i}}\\
  &= \frac{1}{N!}\sum_{n=0}^{\infty}\underset{(n\Delta < E_i < (n+1)\Delta)}{\sum_{i}}e^{-\beta E_{i}}\\
  &\simeq \frac{1}{N!}\sum_{n=0}^{\infty}\Omega_{V,N}(n\Delta)e^{-\beta n\Delta}
\end{align}
となる。すなわち、領域$[n\Delta,(n+1)\Delta]$のエネルギー固有状態を束としてまとめて和をとってから、その束に対して和をとることになる。このとき、
\begin{align}
  \frac{1}{N!}\underset{(n\Delta < E_i < (n+1)\Delta)}{\sum_{i}} 1 &= \Omega_{V,N}((n+1)\Delta) - \Omega_{V,N}(n\Delta)\\
  &= \Delta \dv{\Omega_{V,N}(E)}{E}\left.\right|_{E=n\Delta}
\end{align}
である。したがって、
\begin{align}
  Z_{V,N}(\beta) &\simeq \sum_{n=0}^{\infty}\Delta\dv{\Omega_{V,N}(E)}{E}e^{-\beta n\Delta}\\
  &= \int_{0}^{\infty}\dd E \dv{\Omega_{V,N}(E)}{E}e^{-\beta E} \label{eq:canlap}\\
  &= \beta \int_{0}^{\infty}\dd E \Omega_{V,N}(E)e^{-\beta E}
\end{align}
となる。ここで、状態数の熱力学極限を考えると、
\begin{align}
  Z_{V,N}(\beta) &\simeq \beta \int_{0}^{\infty}\dd E \exp(V\sigma(E/N,V/N))e^{-\beta E}\\
  &= \beta V \int_{0}^{\infty}\dd \epsilon \exp(V(\sigma(\epsilon,\rho)-\beta \epsilon))
\end{align}
となる。ここで、$\epsilon = E/N$とおいた。この積分を評価することを考える。いま、$(\sigma(\epsilon,\rho)-\beta \epsilon)$を、その最大値をとる点$\epsilon^{*}$の周りでテイラー展開すると、
\begin{align}
  \sigma(\epsilon,\rho)-\beta \epsilon &= \sigma(\epsilon^{*},\rho)-\beta \epsilon^{*} + \frac{1}{2}\pdv[2]{\sigma}{\epsilon}(\epsilon-\epsilon^{*})^2 + \cdots
\end{align}
となる。ここで、$\alpha = -\pdv[2]{\sigma}{\epsilon}$とおき、これが正であると仮定する。\footnote{これは、より厳密な証明では必要ないことが知られている。}このとき、最大値周りだけが積分に寄与することから、
\begin{align}
  Z_{V,N}(\beta) &\simeq \beta V \int_{0}^{\infty}\dd \epsilon \exp(V(\sigma(\epsilon^{*},\rho)-\beta \epsilon^{*})) \exp(-\frac{1}{2}\alpha V(\epsilon-\epsilon^{*})^2)\\
  &= \beta V \exp(V(\sigma(\epsilon^{*},\rho)-\beta \epsilon^{*}))\sqrt{\frac{2\pi}{\alpha V}}
\end{align}
となる。これをもちいて、ヘルムホルツ自由エネルギー密度を評価すると、
\begin{align}
  f(\beta,\rho)_V &= -\frac{1}{V\beta}\log Z_{V,N}(\beta)\\
  &= -\frac{1}{\beta}(\sigma(\epsilon^{*},\rho) -\beta \epsilon^{*} ) -\frac{1}{\beta}\log \sqrt{\frac{2\pi}{\alpha V}}\\
  &\simeq -\frac{1}{\beta}(\sigma(\epsilon^{*},\rho) -\beta \epsilon^{*} ) \\
  &= \underset{\epsilon}{\min} \qty(\epsilon - \frac{\sigma(\epsilon,\rho)}{\beta})
\end{align}
となる。特に、体積を無限大に取ると、これまでの$\simeq$の部分が厳密になることが知られており、
\begin{align}
  f(\beta,\rho) &= \underset{u}{\min} \qty(u - Ts(u,\rho))
\end{align}
となる。したがって、MCで導いたエントロピーと、Cで導いたヘルムホルツ自由エネルギーがルジャンドル変換によって結ばれており、同じ熱力学極限を持つことがわかる。すなわち、2つの分布は等価であることがわかる。\hfill\qedsymbol\\






%残り書くこと:カノニカル分布の続き、グランドカノニカル分布、3つのモデルの等価性、フェルミ・ディラック分布、ボース・アインシュタイン分布、分布の他の導出

\subsection{その他}
統計力学における諸注意や、ちょっとした議論をまとめておく。\\

\subsubsection{独立な部分からなる系}

\subsubsection{分布間の関係}
(\ref{eq:canlap})式から、
\begin{align}
  Z_{V,N}(\beta) &= \int_{0}^{\infty}\dd E \dv{\Omega_{V,N}(E)}{E}e^{-\beta E}
\end{align}
である。これは、状態密度をラプラス変換することで、分配関数を得ているということになる。\\
逆に、逆ラプラス変換により、
\begin{align}
  \dv{\Omega_{V,N}(E)}{E} &= \frac{1}{2\pi i}\int_{\beta' - i\infty}^{\beta' + i\infty}\dd \beta e^{\beta E}Z_{V,N}(\beta)
\end{align}
となる。以上より、

\begin{center}
\begin{tikzpicture}
  \matrix (m) [matrix of math nodes,row sep=3em,column sep=3em,minimum width=2em]
  {
      D(E) & S(U,V,N) \\
      Z_{V,N}(\beta) & F(T,V,N) \\
  };
  \path[-stealth]
    (m-1-1) edge [->] node [above] {} (m-1-2)
        edge [<->] node [left] {ラプラス変換} (m-2-1)
    (m-2-1) edge [->] node [below] {} (m-2-2)
    (m-1-2) edge [<->] node [right] {ルジャンドル変換} (m-2-2);
\end{tikzpicture}
\end{center}
という関係があることがわかる。\\

\textbf{ex:$N$粒子理想気体}\\
理想気体の分配関数は、(\ref{eq:idealz})式である。これをラプラス逆変換すると、
\begin{align}
  D(E) &= \frac{1}{2\pi i}\int_{\beta' - i\infty}^{\beta' + i\infty}\dd \beta e^{\beta E}\frac{V^N}{h^{3N}N!}\left( \frac{2\pi m}{\beta} \right)^{3N/2}
\end{align}
となる。この複素積分は、以下の経路を考えると良い。\\

\begin{figure}[H]
  \centering
  \begin{tikzpicture}
      % 軸の設定
      \draw[->] (-4,0) -- (4,0) node[right] {Re};
      \draw[->] (0,-3) -- (0,3) node[above] {Im};
  
      % 曲線の描画
      \draw[thick] (1,-3) -- (1,3);
      \draw[thick,domain=270:90] plot ({1+3*cos(\x)}, {3*sin(\x)});
  
      % 矢印の描画
      \draw[->] (1,-3) -- (1,-2); % 下から上への矢印
      \draw[->] (1,3) arc (90:120:3); % 上の曲線上の矢印
      \draw[->] (1,-3) arc (270:240:3); % 下の曲線上の矢印

      %原点に印
      \fill (0,0) circle[radius=2pt];
  
      % ラベルの追加
      \node at (1.2,0.2) {$\beta'$};
      \node at (1.8,2.8) {$\beta' + i\infty$};
      \node at (1.8,-2.8) {$\beta' - i\infty$};
      \node at (-0.5,-0.5) {Pole at origin};
  \end{tikzpicture}
  \caption{逆ラプラス変換の複素積分の積分経路 $C$.}
  \end{figure}
このとき、原点が極となっていることがわかる。この経路に沿った線積分に等しいので、留数定理を用いて、
\begin{align}
  D(E) &= \frac{1}{2\pi i}\int_{\beta' - i\infty}^{\beta' + i\infty}\dd \beta e^{\beta E}\frac{V^N}{h^{3N}N!}\left( \frac{2\pi m}{\beta} \right)^{3N/2}\\
  &= \frac{1}{2\pi i} 2\pi i \frac{V^N}{h^{3N}N!}\left(2\pi m\right)^{3N/2}\left(\frac{E^{3N/2-1}}{(3N/2-1)!}\right)\\
  &= \frac{V^N}{h^{3N}N!}\left(2\pi m\right)^{3N/2}\left(\frac{E^{3N/2-1}}{(3N/2-1)!}\right)
\end{align}
となる。また、(\ref{eq:idealgas})式から、
\begin{align}
  \dv{\Omega}{E} &= \frac{V^N}{h^{3N}N!}\left(2\pi m\right)^{3N/2}\left(\frac{E^{3N/2-1}}{(3N/2-1)!}\right)
\end{align}
である。したがって、たしかに、ラプラス変換逆変換によって状態密度を求めることができた。

\subsection{母関数との対応}
\subsubsection{母関数との対応}
各分布についてのモーメント母関数を考えてみる。\\

カノニカル分布を考える。カノニカル分布を再掲すると、
\begin{align}
  p_i = \frac{e^{-\beta E_i}}{Z(\beta)}
\end{align}
である。このとき、モーメント母関数は、
\begin{align}
  M(k) &= \sum_{i}\frac{e^{-(\beta - k)E_i}}{Z(\beta)}\\
  &= \frac{Z(\beta - k)}{Z(\beta)}
\end{align}
とかくことができる。これを用いて、n次のモーメントは、
\begin{align}
  \expval{E^n} &= \pdv[n]{M(k)}{k}\Big|_{k=0}\\
  &= \frac{1}{Z(\beta)}\pdv[n]{Z(\beta - k)}{k}\Big|_{k=0}\\
  &= (-1)^n\frac{1}{Z(\beta)}\pdv[n]{Z(\beta-k)}{k}\Big|_{k=0}\\
  &= (-1)^n\frac{Z^{(n)}(\beta)}{Z(\beta)}
\end{align}
となる。ここで、$Z^{(n)}(\beta)$は、$n$階微分である。とくに、1次のモーメントは、
\begin{align}
  \expval{E} &= -\frac{1}{Z(\beta)}\pdv{Z(\beta - k)}{k}\Big|_{k=0}\\
  &= -\pdv{\beta}\log Z(\beta)
\end{align}
となる。\\
この母関数との関連を見ることで、分配関数から熱力学量が出てくる理由が見えてくる。
モーメント母関数を用いて計算したときは最後に$k=0$としたわけだが、逆に、$\frac{e^{-\beta E_i}}{Z(\beta)}$は、はじめから$k=0$としたモーメント母関数であると考えることができる。すなわち、
\begin{align}
  M(\beta) = \frac{e^{-\beta E_i}}{Z(\beta)}
\end{align}
のように考えることができる。ただし、このときのモーメント関数は、すでに$k=0$としているので、最後に値を代入する作業は必要ない。また、$\beta$微分に分配関数が巻き込まれないように、分配関数を外に出してから計算する必要がある。すなわち、
\begin{align}
  \sum_{i} e^{-\beta E_i} &= Z(\beta) \label{eq:zmoment}
\end{align}
を微分して情報をとりだしてから、分配関数で割ってやるという手順が必要である。このとき、(\ref{eq:zmoment})式は、モーメント母関数とみなすことができる。\\
実際にn次のモーメントを計算すると、
\begin{align}
  \expval{E^n} &= \frac{1}{Z(\beta)}\pdv[n]{Z(\beta)}{\beta}\\
  &= \frac{1}{Z(\beta)}(-1)^nZ^{(n)}(\beta)
\end{align}
となる。特に、1次のモーメントは、
\begin{align}
  \expval{E} &= -\frac{1}{Z(\beta)}\pdv{Z(\beta)}{\beta}\\
  &= -\pdv{\beta}\log Z(\beta)
\end{align}
となる。\\
また、分配関数をモーメント母関数とみなすということは、$\log Z$をキュムラント母関数とみなすことにもなる。実際、
\begin{align}
  \pdv[2]{\log Z}{\beta} &= \sigma^2(\beta)
\end{align}
である。((\ref{eq:cumulant2})式を参照)\\

まとめると、分配関数は、エネルギーのモーメント母関数とみなすことができ、確率分布の情報を取り出すことができるのである。\\ 

ところで、この話をMCにも持ち込めないかを考えてみる。Cでみたこととしては、確率分布の規格化
定数を母関数として取り扱うことができたということである。

\subsubsection{母関数との関係2}
"許された状態"の密度は、
\begin{align}
  w = \sum_{i}\delta(E-E_{i})
\end{align}
である。このとき、エントロピーが、
\begin{align}
  S = k\log W
\end{align}
である。これは、Wをモーメント母関数とみなしたときのキュムラント母関数である。\footnote{何のモーメント母関数なのかは謎だが、カノニカル分布との対応を見てなんとなく書いてみた。}\\
また、
\begin{align}
  W = e^{\frac{S}{k}}
\end{align}
より、
\begin{align}
  p_i = \frac{1}{W} = \exp(-\frac{S}{k}) = \exp(-V \frac{s}{k})
\end{align}
となる。よって、エネルギー分布$p_i$のレート関数は$\frac{s}{k}$である。\\

また、分配関数は、
\begin{align}
  Z_{V,N}(\beta) &= \int_{0}^{\infty}\dd E w e^{-\beta E}
\end{align}
これと、モーメント母関数の定義(\ref{eq:moment})式を見比べてみると、分配関数は、$w$を確率密度とみなしたときの(すなわち、$W$を確率とみなしたときの)、エネルギーのモーメント母関数になっていることがわかる。\footnote{ただし、状態密度が確率分布でないから、本当にモーメント母関数であるとはいえないのだが。}\\
モーメント母関数が求まったので、キュムラント母関数も求まる。キュムラント母関数の定義(\ref{eq:cumulant})式を見ると、
\begin{align}
  \frac{1}{k}\Phi = \log Z_{V,N}(\beta)
\end{align}
なる量がキュムラント母関数である。ここで、左辺の$k$はボルツマン定数、$\Phi$はマシュー関数である。要するに、キュムラント母関数は、完全な熱力学関数に対応する。\\
キュムラント母関数は、ゆらぎと対応していたのであった。試しに、$k\Phi$を$\beta$で微分してみると、
\begin{align}
  \pdv[2] {\Phi}{\beta} &= k\sigma^2
\end{align}
となる。これの両辺$\beta^2$をかけると、
\begin{align}
  \beta^2\pdv[2] {\Phi}{\beta} &= k\beta^2\sigma^2 =C_{V}
\end{align}
となり、比熱が出てくる。\footnote{この左辺は見慣れないかもしれないが、
\begin{align}
  C(T,V,N) = -T\pdv[2]{F}{T}
\end{align}
のマシュー関数版である。実際、
\begin{align}
  \pdv[2]{T} &= k^2\beta^2\pdv{\beta}\left(\beta^2 \pdv{\beta}\right)
\end{align}
を用いると、
\begin{align}
  C(T,V,N) &= -T\pdv[2]{F}{T}\\
  &=\beta\pdv{\beta}\left(\beta^2\pdv{\beta}\right)\left(\frac{\Phi}{\beta}\right)\\
  &=\beta^2\pdv[2]{\Phi}{\beta}
\end{align}
となる。}\\

また、キュムラント母関数とレート関数はルジャンドル変換によって結ばれているのであった。すなわち、
\begin{align}
  \phi = s - \frac{u}{T}
\end{align}
である。これは、エントロピーとマシュー関数がルジャンドル変換で結ばれていることをに対応する。\\

また、グランドカノニカル分布についても考えてみる。グランドカノニカル分布の大分配関数は、
\begin{align}
  \Xi = \sum_{N=0}^{\infty}Z_{V,N}(\beta)\exp(\beta \mu N)
\end{align}
である。これは、$Z$を確率分布と見たときの、粒子数に対するモーメント母関数である。このときのキュムラント母関数は、
\begin{align}
  kQ = \log \Xi
\end{align}
である。ただし、$Q$はクラマース関数。したがって、グランドカノニカル分布の大分配関数は、粒子数のキュムラント母関数である。\\

以上より、
\begin{center}
  \begin{tikzpicture}
    \matrix (m) [matrix of math nodes, row sep=4em, column sep=6em, minimum width=2em]
    {
        W & S \\
        Z & \Phi \\
        \Xi & Q \\
    };

    % Labels above nodes
    \node[font=\footnotesize,above=of m-1-1] {モーメント母関数};
    \node[font=\footnotesize,above=of m-1-2] {キュムラント母関数};

    \path[-stealth]
      (m-1-1) edge [->] node [font=\small, above] {$\log$} (m-1-2)
      (m-1-1) edge [<->] node [font=\small, left] {ラプラス変換} (m-2-1)
      (m-2-1) edge [->] node [font=\small, above] {$\log$} (m-2-2)
      (m-1-2) edge [<->] node [font=\small, right] {ルジャンドル変換} (m-2-2)
      (m-2-2) edge [<->] node [font=\small, right] {ルジャンドル変換} (m-3-2)
      (m-3-2) edge [<-] node [font=\small, below] {$\log$} (m-3-1)
      (m-2-1) edge [<->] node [font=\small, left] {ラプラス変換} (m-3-1);
  \end{tikzpicture}
\end{center}
とも書くことができる。

\subsection{分布の他の導出方法}
カノニカル分布の導出方法はいろいろある。ここでは、その他の導出方法をいくつかみていく。\\
\textbf{カノニカル分布(状態数の利用)}\\
熱浴の状態密度を$D_{\text{bath}}$、系の状態密度を$D_{\text{sys}}$、全系の状態密度を$D$とする。このとき、着目系のエネルギーが$[E-\Delta E,E]$である状態数は、
\begin{align}
  D_{\text{sys}}(E)\Delta E D_{\text{bath}}(E_{\text{tot}}-E)\Delta E_{\text{bath}}
\end{align}
である。ここで、$E_{\text{tot}}$は、全エネルギーである。このとき、すべての状態数は、
\begin{align}
  \int \dd E D_{\text{sys}}(E)D_{\text{bath}}(E_{\text{tot}}-E)\Delta E_{\text{bath}}
\end{align}
である。このとき、エネルギーが$E$である状態の確率は、
\begin{align}
  p(E) = \frac{D_{\text{sys}}(E)D_{\text{bath}}(E_{\text{tot}}-E)\Delta E_{\text{bath}}}{\int \dd E D_{\text{sys}}(E)D_{\text{bath}}(E_{\text{tot}}-E)\Delta E_{\text{bath}}}
\end{align}
である。ここで、
\begin{align}
  D_{\text{bath}}(E_{\text{bath}})\Delta E_{\text{bath}} = \exp \qty(\frac{S_{\text{bath}}(E_{\text{bath}})}{k})
\end{align}
である。両辺対数をとって微分することで、
\begin{align}
  \pdv{D_{\text{bath}}}{E_{\text{bath}}} = \frac{1}{kT}D_{\text{bath}}
\end{align}
となる。また、熱浴の温度が変化しないこと、すなわち、比熱が無限大になることを仮定して、
\begin{align}
  \pdv{T}{E_{\text{bath}}} = 0
\end{align}
となる。したがって、$D_{\text{bath}}(E_{\text{tot}}-E)$をテイラー展開すると、
\begin{align}
  D_{\text{bath}}(E_{\text{tot}}-E) &= \sum_{n=0}^{\infty}\frac{1}{n!}\qty(-\frac{1}{kT})^n D_{\text{bath}}(E_{\text{tot}})\\
  &= D_{\text{bath}}(E_{\text{tot}})\exp\qty(-\beta E)
\end{align}
となる。したがって、
\begin{align}
  p(E) &= \frac{D_{\text{sys}}(E) e^{-\beta E}}{\int \dd E D_{\text{sys}}(E) e^{-\beta E}}\\
  &= \frac{D_{\text{sys}}(E) e^{-\beta E}}{Z}
\end{align}
となる。ただし、
\begin{align}
  Z = \int \dd E D_{\text{sys}}(E) e^{-\beta E}
\end{align}
である。これがカノニカル分布である。\\

\textbf{シャノンエントロピーを、拘束条件のもと最大化する方法}\\
エネルギーを一定に保った時の、シャノンエントロピー最大化問題を考える。シャノンエントロピーは確率分布関数の汎関数であるから、変分によって停留点を探す。
\begin{align}
  \tilde{S}= -k_B\sum_{i}p_i\log p_i -\lambda\left(\sum_{i}p_i - 1\right)-\rho\left(\sum_{i}p_iE_i - U\right)  
\end{align}
である。ここで、$\lambda$と$\rho$は未定乗数である。微小な確率変分を考えると、
\begin{align}
  \delta \tilde{S} &= -k_B\sum_{i}(p_i + \delta p_i)\log (p_i + \delta p_i) -\lambda\left(\sum_{i}(p_i + \delta p_i)- 1\right) -\rho\left(\sum_{i}(p_i + \delta p_i)E_i - U\right)-\tilde{S}\\
  &= -k_B\sum_{i}\left(\delta p_i\log p_i + (p_i + \delta p_i)\log \left(1 + \frac{\delta p_i}{p_i}\right)\right)  -\lambda\left(\sum_{i}\delta p_i\right)-\rho\left(\sum_{i}\delta p_iE_i\right)
\end{align}
となる。ここで、$\log(1+x) = x + O(x^2)$であることを用いて、
\begin{align}
  \delta \tilde{S} &= -k_B\sum_{i}\left(\delta p_i\log p_i + \delta p_i\right)  -\lambda\left(\sum_{i}\delta p_i\right)-\rho\left(\sum_{i}\delta p_iE_i\right)\\
  &= \sum_{i}\delta p_i\left(-k_B\log p_i - k_B - \lambda - \rho E_i\right) + O(\delta p_i^2)
\end{align}
となる。したがって、
\begin{align}
  -k_B\log p_i - k_B - \lambda - \rho E_i = 0
\end{align}
である。これを変形して、
\begin{align}
  p_i = \exp(-1-\frac{\lambda}{k_B}-\frac{\rho E_i}{k_B})
\end{align}
ここで、
\begin{align}
  &Z = \exp(1 + \frac{\lambda}{k_B})\\
  &\beta = \frac{\rho}{k_B}
\end{align}
とおくと、
\begin{align}
  p_i = \frac{\exp(-\beta E_i)}{Z}
\end{align}
となる。

\subsection{典型性に関する追記}


\section{非平衡統計力学}

\section{量子力学}

\section{相対論}

\section{場の量子論}

\section{その他}





\end{document}